# DICOM 影像管理页面开发指南

## 开发流程

1. 创建新路由组件
```bash
cd platform/app/src/routes/
mkdir DICOMManagement
touch DICOMManagement/index.tsx
```

2. 添加路由配置
在 `platform/app/src/routes/index.ts` 中添加：
```typescript
{
  path: '/dicom-management',
  component: lazy(() => import('./DICOMManagement')),
  exact: true,
}
```

3. 创建核心组件
```tsx
// platform/app/src/routes/DICOMManagement/index.tsx
import React, { useState } from 'react';
import { useDICOMFile } from '@ohif/core';
import { Button, Table } from '@ohif/ui';

const DICOMManagement = () => {
  const [files, setFiles] = useState<File[]>([]);
  const { loadDICOMFile } = useDICOMFile();

  const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>) => {
    const uploadedFiles = Array.from(event.target.files || []);
    setFiles(prev => [...prev, ...uploadedFiles]);
  };

  const handleFileProcess = async (file: File) => {
    try {
      const dicomData = await loadDICOMFile(file);
      console.log('Processed DICOM:', dicomData);
    } catch (error) {
      console.error('DICOM processing failed:', error);
    }
  };

  return (
    <div className="p-4">
      <h1>DICOM 文件管理</h1>
      <input type="file" multiple onChange={handleFileUpload} />

      <Table>
        <thead>
          <tr>
            <th>文件名</th>
            <th>大小</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          {files.map((file, index) => (
            <tr key={index}>
              <td>{file.name}</td>
              <td>{(file.size / 1024).toFixed(2)} KB</td>
              <td>
                <Button onClick={() => handleFileProcess(file)}>
                  处理
                </Button>
              </td>
            </tr>
          ))}
        </tbody>
      </Table>
    </div>
  );
};

export default DICOMManagement;
```

4. 添加样式
在 `platform/app/src/routes/DICOMManagement/styles.css` 中添加：
```css
.dicom-management-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

.file-upload {
  margin-bottom: 20px;
}

.dicom-table {
  width: 100%;
  margin-top: 20px;
}
```

5. 注册新页面
在对应模式中注册新页面：
```typescript
// modes/basic-dev-mode/src/index.ts
import DICOMManagement from '../../platform/app/src/routes/DICOMManagement';

export default {
  id: 'dicom-management',
  routePath: '/dicom-management',
  component: DICOMManagement,
};
```

## 核心功能说明

1. 文件上传
- 支持多文件选择
- 实时显示上传文件列表
- 文件大小显示

2. DICOM 处理
- 使用 OHIF 核心 DICOM 处理工具
- 支持 DICOM 元数据解析
- 错误处理机制

3. 用户界面
- 使用 OHIF UI 组件库
- 响应式布局
- 表格展示文件信息

## 测试建议
1. 创建单元测试：
```typescript
// tests/DICOMManagement.spec.ts
import { render, screen } from '@testing-library/react';
import DICOMManagement from '../platform/app/src/routes/DICOMManagement';

describe('DICOMManagement', () => {
  it('renders file upload input', () => {
    render(<DICOMManagement />);
    expect(screen.getByRole('file')).toBeInTheDocument();
  });
});
```

2. 端到端测试：
```typescript
// tests/e2e/DICOMManagement.e2e.ts
describe('DICOM Management', () => {
  it('should upload and display DICOM files', () => {
    cy.visit('/dicom-management');
    cy.get('input[type="file"]').attachFile('sample.dcm');
    cy.contains('sample.dcm').should('be.visible');
  });
});
